#!/bin/bash

### AZP Paket Meneceri 4.0
# AZP Offical Site: https://azp-paket-sistemi.github.io
# AZP Offical Depo: https://azp-paket-sistemi.github.io/azp-depo

# © 2021-2023 AZP
# © 2019-2023 PacPERRO

# Tərcümə faylı
TEXTDOMAINDIR=/usr/share/locale
TEXTDOMAIN=azp

# Rənglər
error=$(echo -e "\033[1;31m E: \033[:0m")
process=$(echo -e "\033[1;34m P: \033[:0m")
finished=$(echo -e "\033[1;32m F: \033[:0m")
info=$(echo -e "\033[1;36m I: \033[:0m")

depo_add(){
   azpdepolink=$1
   mkdir -p /tmp/azp_depo_add
   cd /tmp/azp_depo_add
   wget $azpdepolink/[depo]/depo.zip &>/dev/null
   mkdir depo_file
   echo "$process" $"'depo.zip' extract..."
   unzip depo.zip -d depo_file &>/dev/null
   cd depo_file
   dlink=$(cat depo)
   echo -e "\033[1;35m AZP Repo: $dlink \033[:0m"
   echo -e "\033[1;32m depo == /etc/azp/azp-depo \033[:0m"
   echo -e "\033[1;32m info-depo == /etc/azp/azp-depo \033[:0m"
   cp -p info-depo depo /etc/azp/azp-depo/
   cd ..
   rm -r /tmp/azp_depo_add
}


if [ -f /etc/azp/azp-depo/depo ] && [ -f /var/cache/azp/azp-depo ]
then
  exit
fi
if [ -f /var/cache/azp/azp-depo ]
then
  azp_repo=$(cat /var/cache/azp/azp-depo)
fi
echo "$process" $"A repository is not set. Must be added. (To add a standard azp repository: -azpd)"
sleep 1
read -p $"Add Repo: " add_depo
if [[ ${add_depo:0:8} != "https://" ]]
then
  if [[ ${add_depo:0:7} != "http://" ]]
  then
    if [[ ${add_depo:0:5} != "-azpd" ]]
    then
      echo "$error" $"The link is wrong !"
      exit 1
    else
      depo_add $azp_repo
    fi
  else
    depo_add $add_depo
  fi
else
  depo_add $add_depo
fi